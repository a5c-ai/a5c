{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://a5c.ai/schemas/events/ne.schema.json",
  "title": "Normalized Event (NE)",
  "type": "object",
  "required": [
    "id",
    "provider",
    "type",
    "occurred_at",
    "repo",
    "actor",
    "payload",
    "provenance"
  ],
  "additionalProperties": false,
  "properties": {
    "id": {
      "type": "string",
      "description": "Provider-unique identifier for this event"
    },
    "provider": {
      "type": "string",
      "enum": ["github"],
      "description": "Event source provider"
    },
    "type": {
      "type": "string",
      "enum": [
        "workflow_run",
        "pull_request",
        "push",
        "issue_comment",
        "commit",
        "job",
        "step",
        "issue",
        "release",
        "deployment",
        "check_run",
        "alert"
      ],
      "description": "Core normalized type"
    },
    "occurred_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO timestamp for the event occurrence"
    },
    "repo": {
      "type": "object",
      "required": ["id", "name", "full_name"],
      "additionalProperties": false,
      "properties": {
        "id": { "type": "integer" },
        "name": { "type": "string" },
        "full_name": { "type": "string" },
        "private": { "type": "boolean" },
        "visibility": {
          "anyOf": [
            { "type": "string", "enum": ["public", "private", "internal"] },
            { "type": "null" }
          ]
        }
      }
    },
    "ref": {
      "type": "object",
      "required": [],
      "additionalProperties": false,
      "properties": {
        "name": { "type": "string" },
        "type": {
          "anyOf": [
            { "type": "string", "enum": ["branch", "tag", "unknown"] },
            { "type": "null" }
          ]
        },
        "sha": { "type": "string" },
        "base": { "type": "string" },
        "head": { "type": "string" }
      }
    },
    "actor": {
      "type": "object",
      "required": ["id", "login", "type"],
      "additionalProperties": false,
      "properties": {
        "id": { "type": "integer" },
        "login": { "type": "string" },
        "type": { "type": "string" }
      }
    },
    "payload": {
      "description": "Provider-native payload (raw)",
      "anyOf": [{ "type": "object" }, { "type": "array" }]
    },
    "enriched": {
      "type": "object",
      "additionalProperties": true,
      "description": "Optional enriched metadata, derived fields, and correlations"
    },
    "labels": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Free-form labels for routing and policies"
    },
    "provenance": {
      "type": "object",
      "required": ["source"],
      "additionalProperties": false,
      "properties": {
        "source": { "type": "string", "enum": ["action", "webhook", "cli"] },
        "workflow": {
          "type": "object",
          "required": [],
          "additionalProperties": false,
          "properties": {
            "name": { "type": "string" },
            "run_id": {
              "anyOf": [{ "type": "integer" }, { "type": "string" }]
            }
          }
        }
      }
    },
    "composed": {
      "description": "Optional composed events emitted by rules; see specs ยง6.1",
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["key"],
        "properties": {
          "key": {
            "type": "string",
            "description": "Machine-friendly identifier for the composed event"
          },
          "reason": {
            "type": ["string", "null"],
            "description": "Optional human-readable reason derived from matched criteria"
          },
          "targets": {
            "type": "array",
            "items": { "type": "string" },
            "description": "Optional list of intended agent recipients"
          },
          "labels": {
            "type": "array",
            "items": { "type": "string" },
            "description": "Optional routing labels for the composed event"
          },
          "payload": {
            "description": "Optional payload projected from the source event",
            "anyOf": [
              { "type": "object" },
              { "type": "array" },
              { "type": "null" }
            ]
          }
        }
      }
    }
  }
}
