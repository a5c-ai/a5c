# Release workflow: GPR publish 401 analysis

- Failed run: https://github.com/a5c-ai/events/actions/runs/17749912082
- Failing step: Publish to npmjs (main only)
- Error: `npm error 401 Unauthorized - PUT https://npm.pkg.github.com/@a5c-ai%2fevents`

## Root cause

The publish step is named "npmjs (main only)" but npm still targets GitHub Packages due to `.npmrc` in repo:

```
//npm.pkg.github.com/:_authToken=${NPM_TOKEN}
@a5c-ai:registry=https://npm.pkg.github.com/
```

Even though the step changes registry with `--registry=https://registry.npmjs.org`, npm still tries to PUT to GPR likely because publish resolved the scoped package to the configured scope registry and/or token is missing for GPR when attempting info requests. The log shows it attempted GPR and failed with the token.

## Fix

- In the npmjs publish step, override the scope registry for `@a5c-ai` during publish by writing a temporary `.npmrc` that points `@a5c-ai` to npmjs and uses `NODE_AUTH_TOKEN`.
- Ensure `npm whoami --registry=https://registry.npmjs.org` passes before publish, aiding diagnostics.
- Keep existing semantic-release GPR config untouched for other steps.

## Verification steps

- Ran `npm ci` locally; build succeeded.
- PR will update workflow to create a temporary `.npmrc` for the npmjs publish step only.
  End of analysis.
