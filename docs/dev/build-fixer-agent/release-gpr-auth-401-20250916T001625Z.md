# Release workflow: GPR publish 401 analysis

- Failed run: https://github.com/a5c-ai/events/actions/runs/17749912082
- Failing step: Publish to npmjs (main only)
- Error: `npm error 401 Unauthorized - PUT https://npm.pkg.github.com/@a5c-ai%2fevents`

## Root cause

The publish step is named "npmjs (main only)" but npm still targets GitHub Packages due to `.npmrc` in repo:

```
//npm.pkg.github.com/:_authToken=${NPM_TOKEN}
@a5c-ai:registry=https://npm.pkg.github.com/
```

Even though the step passes `--registry=https://registry.npmjs.org`, scoped publish prefers the project `.npmrc` scope mapping, so npm attempts to publish to GitHub Packages and fails with 401.

## Fix

- During the npmjs publish step, temporarily move the project `.npmrc` away and use a temporary user config that points `@a5c-ai` to npmjs and authenticates with `NODE_AUTH_TOKEN`.
- Verify with `npm whoami` against npmjs before publish.
- Restore the original `.npmrc` afterwards.

## Verification steps

- Local build completes with `npm ci && npm run build`.
- New workflow step will isolate publish config to npmjs only.
