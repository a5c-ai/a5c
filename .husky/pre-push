#!/usr/bin/env sh
# POSIX sh: avoid non-portable 'pipefail'
set -eu

if [ -n "${A5C_SKIP_PREPUSH:-}" ] || [ -n "${SKIP_PREPUSH:-}" ]; then
  echo "Skipping pre-push due to env flag."
  exit 0
fi

echo "Pre-push: typecheck + related tests"
# Run typecheck first (silent for cleaner output)
npm run --silent typecheck
# Try related tests first; if it fails or finds no matches, fallback to full
npm run --silent prepush || npm run --silent prepush:full
