name: Implement Issues by comment slash command
metadata:
  runner-name: reactor
on:
  issue_comment:
    filters:      
      - expression: ${{ event.enriched.slash_commands | map(command) | contains('implement-issue') }}
    skip:
      # is already closed
      - expression: ${{ event.issue.closed == true }}
emit:
  implement_issue:
    type: issue_implement
    payload:
      original_event: ${{ event }}
      issue: ${{ event.issue }}
---
name: Implement Issues by label or slash command
metadata:
  runner-name: reactor
on:
  issue:
    filters:
      # implement_issue label or slash command was used
      - expression: ${{ event.type == 'labeled' && event.label.name == 'implement_issue' }}
      - expression: ${{ event.enriched.slash_commands | map(attribute=command) | contains('implement-issue') }}
    skip:
      # is already closed
      - expression: ${{ event.issue.closed == true }}
emit:
  implement_issue:
    type: issue_implement
    payload:
      original_event: ${{ event }}
      issue: ${{ event.issue }}
actions:
  - type: label_issue
    params:
      issue: ${{ event.issue.html_url }}
      add_labels: [implement_issue_requested]
      remove_labels: [implemented]
---
name: Implement Issue Agent Run
metadata:
  runner-name: agents
on:
  implement_issue:
actions:
  - type: label_issue
    params:
      issue: ${{ event.issue.html_url }}
      add_labels: [implement_issue_in_progress]
      remove_labels: [implement_issue_requested]
  - type: agent_run
    params: {}
    env:
      - name: SOME_ENV
        value: some_value
  - type: label_issue
    params:
      issue: ${{ event.issue.html_url }}
      add_labels: [implemented]
      remove_labels: [implement_issue_in_progress]
