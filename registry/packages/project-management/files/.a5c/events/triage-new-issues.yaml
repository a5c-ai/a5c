---
name: Auto Triage New Issues
metadata:
  runner-name: reactor
on:
  issue:
    filters:
      - expression: ${{ event.type == 'opened' }}
    skip:
      - expression: ${{ env.A5C_EVENTS_AUTO_TRIAGE_NEW_ISSUES == 'false' }}
actions:
  - type: label_issue
    params:
      issue: ${{ event.issue.html_url }}
      add_labels: [triage]
  - type: add_comment
    params:
      issue: ${{ event.issue.html_url }}
      comment: "Triage requested for issue #${{ event.issue.number }}"
---
name: Triage New Issues
metadata:
  runner-name: reactor
on:
  issue:
    filters:
      # label triage was added
      - expression: ${{ event.type == 'labeled' && event.label.name == 'triage' }}
    skip:
      # is a issue or already closed
      - expression: ${{ event.issue.closed == true }}
      # if triage in progress or already requested
      - expression: ${{ event.labels | contains('triage_in_progress') || event.labels | contains('triage_requested') }}
emit:
  triage_new_issue:
    type: issue_ready_for_triage
    payload:
      original_event: ${{ event }}
      issue: ${{ event.issue }}
      among: 
        - 'bug'
        - 'feature'
        - 'documentation'
        - 'question'
        - 'enhancement'
        - 'devops'
        - 'security'
        - 'performance'
        - 'ux'
        - 'backend'
        - 'frontend'
        - 'database'
        - 'api'
        - 'infrastructure'
        - 'support'
        - 'feature_request'
actions:
  - type: label_issue
    params:
      issue: ${{ event.issue.html_url }}
      add_labels: [triage_requested]
      remove_labels: [triaged]
---
name: Triage Agent Run
metadata:
  runner-name: agents
on:
  triage_new_issue:
actions:
  - type: label_issue
    params:
      issue: ${{ event.issue.html_url }}
      add_labels: [triage_in_progress]
      remove_labels: [triage_requested]
  - type: agent_run
    env:
      - name: SOME_ENV
        value: some_value
    params: {}
  - type: label_issue
    params:
      issue: ${{ event.issue.html_url }}
      add_labels: [triaged]
      remove_labels: [triage_in_progress]
