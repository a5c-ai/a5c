---
name: Create PRs from Issues
metadata:
  runner-name: reactor
on:
  issue:
    filters:
      # label create_pr was added
      - expression: ${{ event.type == 'labeled' && event.label.name == 'create_pr' }}
      # triage enabled in this repo on the a5c/main branch (can be current or event.repository.default_branch) - reads from github content for the current branch (read_github_content fallback to empty string)
    skip:
      # is a issue or already closed
      - expression: ${{ event.issue.closed == true }}
      # if triage in progress or already requested
      - expression: ${{ event.labels | contains('create_pr_in_progress') || event.labels | contains('create_pr_requested') }}
emit:
  create_pr_from_issue:
    type: from_issue
    payload:
      original_event: ${{ event }}
      issue: ${{ event.issue }}
actions:
  - type: label_issue
    params:
      issue: ${{ event.issue.html_url }}
      add_labels: [create_pr_requested]
---
name: Create PR Run
metadata:
  runner-name: reactor
on:
  create_pr_from_issue:
actions:
  - type: label_issue
    params:
      issue: ${{ event.issue.html_url }}
      add_labels: [create_pr_in_progress]
      remove_labels: [create_pr_requested]
  - type: create_pr
    params:
      head_branch: issue/a5c/${{ event.issue.number }}
      base_branch: a5c/main
      title: ${{ event.issue.title }}
      body: ${{ event.issue.body }}
      labels: "${{ event.issue.labels | map(attribute='name') | join(',') }},created_from_issue"
      draft: true
      initial_commit_message: "chore: ${{ event.issue.title }} - initial commit"
      initial_commit_file_content: ${{ event.issue.body }}
      initial_commit_file_name: docs/issues/issue-${{ event.issue.number }}.md
  - type: label_issue
    params:
      issue: ${{ event.issue.html_url }}
      add_labels: [created_pr]
      remove_labels: [create_pr_in_progress]
---
name: Release - merge a5c/main to main
metadata:
  runner-name: reactor
on:
  merge_a5c_main_to_main:
actions:
  - type: create_pr
    params:
      head_branch: a5c/main
      base_branch: main
      title: "Merge a5c/main into main"
      body: "Merge a5c/main into main"
      labels: "release"
      draft: true
---
name: Rebase - merge main to a5c/main
metadata:
  runner-name: reactor
on:
  rebase_main_to_a5c_main:
actions:
  - type: create_pr
    params:
      head_branch: main
      base_branch: a5c/main
      title: "Rebase main into a5c/main"
      body: "Rebase main into a5c/main"
      labels: "rebase"
      draft: true
