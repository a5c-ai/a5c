---
name: Auto Triage New Issues
metadata:
  runner-name: reactor
on:
  issue:
    filters:
      - expression: ${{ event.type == 'opened' && event.label.name == 'e2e-test-run' }}
actions:
  - type: label_issue
    params:
      issue: ${{ event.issue.html_url }}
      add_labels: [e2e-test-run-requested]
  - type: add_comment
    params:
      issue: ${{ event.issue.html_url }}
      comment: "E2E test run requested for issue #${{ event.issue.number }}"
---
name: Triage New Issues
metadata:
  runner-name: reactor
on:
  issue:
    filters:
      # label triage was added
      - expression: ${{ event.type == 'labeled' && event.label.name == 'e2e-test-run-requested' }}
    skip:
      # is a issue or already closed
      - expression: ${{ event.issue.closed == true }}
      # if e2e test run in progress or already requested
      - expression: ${{ event.labels | contains('e2e-test-run_in_progress') || event.labels | contains('e2e-test-run-requested') }}
emit:
  e2e_test_run:
    type: issue_ready_for_e2e_test_run
    payload:
      original_event: ${{ event }}
      issue: ${{ event.issue }}
      among: 
        - 'bug'
        - 'feature'
        - 'documentation'
        - 'question'
        - 'enhancement'
        - 'devops'
        - 'security'
        - 'performance'
        - 'ux'
        - 'backend'
        - 'frontend'
        - 'database'
        - 'api'
        - 'infrastructure'
        - 'support'
        - 'feature_request'
actions:
  - type: label_issue
    params:
      issue: ${{ event.issue.html_url }}
      add_labels: [e2e-test-run-requested]
      remove_labels: [e2e-test-run-requested]
---
name: E2E Test Run Agent Run
metadata:
  runner-name: agents
on:
  e2e_test_run:
actions:
  - type: label_issue
    params:
      issue: ${{ event.issue.html_url }}
      add_labels: [e2e-test-run-in_progress]
      remove_labels: [e2e-test-run-requested]
  - type: agent_run
    env:
      - name: SOME_ENV
        value: some_value
    params: {}
  - type: label_issue
    params:
      issue: ${{ event.issue.html_url }}
      add_labels: [e2e-test-run-completed]
      remove_labels: [e2e-test-run_in_progress]
